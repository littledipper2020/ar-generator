<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>One Talk Auto Receptionist Generator</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700;9..40,800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface-2: #1a1a26;
    --surface-3: #111118;
    --border: #1e1e2e;
    --border-2: #2a2a3d;
    --text: #e8e8f0;
    --text-mid: #b0b0c8;
    --text-dim: #8888a0;
    --text-mute: #55556a;
    --red: #ee0000;
    --red-2: #ff4444;
    --red-3: #ee3333;
    --red-glow: rgba(238,0,0,0.35);
    --red-soft: rgba(238,0,0,0.06);
    --red-border: rgba(238,0,0,0.2);
    --green: #22c55e;
    --green-soft: rgba(34,197,94,0.08);
    --radius: 8px;
    --radius-lg: 10px;
    --radius-xl: 12px;
    --radius-2xl: 14px;
    --radius-3xl: 16px;
    --font: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --mono: 'Space Mono', monospace;
  }
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: var(--font); background: var(--bg); color: var(--text); min-height: 100vh; line-height: 1.5; }
  ::selection { background: rgba(238,0,0,0.25); }
  input, textarea, select, button { font-family: inherit; }
  textarea { resize: vertical; }

  .app { max-width: 880px; margin: 0 auto; padding: 0 20px 40px; }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .header { padding: 32px 0 28px; border-bottom: 1px solid var(--border); }
  .header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
  .logo-row { display: flex; align-items: center; gap: 12px; }
  .logo-mark { width: 40px; height: 40px; border-radius: var(--radius-lg); background: var(--red); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 15px; color: #fff; box-shadow: 0 0 24px var(--red-glow); letter-spacing: -0.02em; }
  .logo-text { font-weight: 700; font-size: 16px; letter-spacing: -0.02em; }
  .logo-sub { color: var(--text-dim); font-weight: 400; }
  .badge { font-family: var(--mono); font-size: 11px; color: var(--red-2); background: rgba(238,0,0,0.08); border: 1px solid var(--red-border); padding: 5px 12px; border-radius: 20px; letter-spacing: 0.04em; }
  .header h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.03em; line-height: 1.2; margin-bottom: 8px; }
  .header p { color: var(--text-dim); font-size: 14px; line-height: 1.6; max-width: 600px; }

  /* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
  .progress-bar { display: flex; gap: 6px; background: var(--surface-3); border-radius: var(--radius-2xl); padding: 8px; margin: 24px 0; border: 1px solid var(--border); overflow-x: auto; }
  .progress-step { flex: 1; display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: var(--radius-lg); background: transparent; border: none; color: var(--text); text-align: left; transition: all 0.2s; cursor: default; opacity: 0.4; min-width: 0; }
  .progress-step.active { background: var(--surface-2); opacity: 1; cursor: pointer; }
  .progress-step.done { background: var(--green-soft); opacity: 1; cursor: pointer; }
  .step-circle { width: 30px; height: 30px; border-radius: 50%; border: 2px solid var(--border-2); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; flex-shrink: 0; transition: all 0.2s; }
  .progress-step.active .step-circle { border-color: var(--red); color: var(--red); }
  .progress-step.done .step-circle { border-color: var(--green); background: var(--green); color: #000; }
  .step-label { font-weight: 600; font-size: 13px; white-space: nowrap; }
  .step-sub { font-size: 11px; color: var(--text-mute); white-space: nowrap; }

  /* ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ */
  .content { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-3xl); padding: 32px 28px; }
  .section-head { margin-bottom: 28px; }
  .section-head h2 { font-size: 22px; font-weight: 700; letter-spacing: -0.02em; }
  .section-head p { color: var(--text-dim); font-size: 14px; margin-top: 4px; }

  /* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
  .field { margin-bottom: 22px; }
  .field-label { display: block; font-weight: 600; font-size: 13px; color: var(--text-mid); margin-bottom: 6px; }
  .field-label .req { color: var(--red); }
  .field-label .hint { font-weight: 400; color: var(--text-mute); font-size: 12px; }
  .field-hint { color: var(--text-mute); font-size: 12px; margin-bottom: 10px; margin-top: 2px; line-height: 1.4; }
  .input { width: 100%; padding: 10px 14px; background: var(--surface-2); border: 1px solid var(--border-2); border-radius: var(--radius); color: var(--text); font-size: 14px; outline: none; transition: border-color 0.2s; }
  .input:focus { border-color: var(--red); box-shadow: 0 0 0 3px rgba(238,0,0,0.1); }
  select.input { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238888a0' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }
  select.input option { background: var(--surface-2); color: var(--text); }

  /* ‚îÄ‚îÄ GRIDS ‚îÄ‚îÄ */
  .industry-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; }
  .industry-card { padding: 14px 10px; background: var(--surface-2); border: 2px solid var(--border-2); border-radius: var(--radius-lg); cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 6px; transition: all 0.15s; color: var(--text); font-size: 12px; font-weight: 600; text-align: center; }
  .industry-card:hover { border-color: #3d3d5c; background: #222233; }
  .industry-card.active { border-color: var(--red); background: var(--red-soft); box-shadow: 0 0 20px rgba(238,0,0,0.12); }
  .industry-card .icon { font-size: 26px; }

  .tone-row { display: flex; gap: 10px; flex-wrap: wrap; }
  .tone-card { flex: 1 1 140px; padding: 14px 12px; background: var(--surface-2); border: 2px solid var(--border-2); border-radius: var(--radius-lg); cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: all 0.15s; color: var(--text); font-size: 13px; }
  .tone-card:hover { border-color: #3d3d5c; }
  .tone-card.active { border-color: var(--red); background: var(--red-soft); }
  .tone-card .desc { font-size: 11px; color: var(--text-mute); }

  /* ‚îÄ‚îÄ DEPARTMENTS ‚îÄ‚îÄ */
  .dept-header { display: flex; gap: 10px; padding: 0 14px 6px; font-size: 11px; color: var(--text-mute); font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; }
  .dept-header .col-name { flex: 2; }
  .dept-header .col-key { width: 70px; text-align: center; }
  .dept-header .col-del { width: 34px; }

  .dept-block { margin-bottom: 12px; background: var(--surface-2); border: 1px solid var(--border-2); border-radius: var(--radius-lg); overflow: hidden; animation: fadeIn 0.25s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
  .dept-main { display: flex; gap: 10px; align-items: center; padding: 8px 10px; }
  .dept-main .input-name { flex: 2; }
  .dept-main .input-key { width: 70px; text-align: center; font-family: var(--mono); font-weight: 700; }
  .remove-btn { width: 34px; height: 34px; border-radius: 50%; border: none; background: transparent; color: var(--text-mute); cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.15s; }
  .remove-btn:hover { background: rgba(238,0,0,0.15); color: var(--red); }

  /* ‚îÄ‚îÄ SUBMENUS ‚îÄ‚îÄ */
  .submenu-area { padding: 0 10px 10px 10px; border-top: 1px dashed var(--border-2); margin-top: 0; }
  .submenu-label { font-size: 11px; font-weight: 600; color: var(--text-mute); text-transform: uppercase; letter-spacing: 0.06em; padding: 10px 0 6px 28px; display: flex; align-items: center; gap: 6px; }
  .submenu-row { display: flex; gap: 8px; align-items: center; padding: 4px 0 4px 28px; }
  .submenu-row .input-sub-name { flex: 2; font-size: 13px; padding: 7px 12px; }
  .submenu-row .input-sub-key { width: 60px; text-align: center; font-family: var(--mono); font-weight: 700; font-size: 13px; padding: 7px 8px; }
  .sub-remove { width: 28px; height: 28px; border-radius: 50%; border: none; background: transparent; color: var(--text-mute); cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .sub-remove:hover { color: var(--red); }
  .sub-add-btn { margin: 6px 0 4px 28px; padding: 5px 14px; background: transparent; border: 1px dashed var(--border-2); border-radius: 6px; color: var(--text-mute); cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.15s; }
  .sub-add-btn:hover { border-color: var(--text-mute); color: var(--text-dim); }
  .submenu-toggle { padding: 5px 12px; background: transparent; border: 1px solid var(--border-2); border-radius: 6px; color: var(--text-mute); cursor: pointer; font-size: 11px; font-weight: 600; margin-left: 28px; margin-top: 8px; margin-bottom: 6px; transition: all 0.15s; }
  .submenu-toggle:hover { border-color: var(--text-mute); color: var(--text-dim); }
  .submenu-toggle.active { border-color: var(--red-border); color: var(--red-3); background: var(--red-soft); }

  .add-btn { margin-top: 4px; padding: 8px 18px; background: transparent; border: 1px dashed var(--border-2); border-radius: var(--radius); color: var(--text-dim); cursor: pointer; font-size: 13px; font-weight: 600; width: 100%; transition: all 0.15s; }
  .add-btn:hover { border-color: var(--text-mute); color: var(--text); }

  .sep { border-top: 1px solid var(--border); margin: 20px 0; }
  .opt-row { display: flex; gap: 24px; align-items: flex-end; flex-wrap: wrap; }
  .check-label { display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--text-mid); cursor: pointer; margin-bottom: 22px; }
  .check-label input { width: 18px; height: 18px; accent-color: var(--red); cursor: pointer; }

  /* ‚îÄ‚îÄ AFTER HOURS ‚îÄ‚îÄ */
  .ah-box { background: var(--surface-3); border-radius: var(--radius-xl); padding: 20px; border: 1px solid var(--border); margin-bottom: 22px; }
  .ah-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .toggle { width: 48px; height: 26px; border-radius: 13px; border: none; position: relative; cursor: pointer; transition: background 0.2s; flex-shrink: 0; }
  .toggle.on { background: var(--red-3); }
  .toggle.off { background: var(--border-2); }
  .toggle-knob { width: 20px; height: 20px; border-radius: 50%; background: #fff; position: absolute; top: 3px; transition: left 0.2s; }
  .toggle.on .toggle-knob { left: 25px; }
  .toggle.off .toggle-knob { left: 3px; }

  .ah-mode-row { display: flex; gap: 10px; margin: 16px 0 12px; }
  .ah-mode-btn { flex: 1; padding: 14px 12px; background: var(--surface-2); border: 2px solid var(--border-2); border-radius: var(--radius-lg); cursor: pointer; text-align: center; transition: all 0.15s; color: var(--text); font-family: inherit; font-size: 13px; }
  .ah-mode-btn:hover { border-color: #3d3d5c; }
  .ah-mode-btn.active { border-color: var(--red); background: var(--red-soft); }
  .ah-mode-btn .mode-icon { font-size: 20px; margin-bottom: 4px; }
  .ah-mode-btn .mode-title { font-weight: 700; font-size: 13px; }
  .ah-mode-btn .mode-desc { font-size: 11px; color: var(--text-mute); margin-top: 2px; }

  .ah-preview { background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; margin-top: 12px; font-size: 13px; color: var(--text-dim); line-height: 1.6; }
  .ah-preview strong { color: var(--text-mid); }

  .ah-custom-list { margin-top: 12px; }
  .ah-custom-header { display: flex; gap: 10px; padding: 0 4px 6px; font-size: 11px; color: var(--text-mute); font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; }
  .ah-custom-row { display: flex; gap: 10px; align-items: center; padding: 6px 0; animation: fadeIn 0.25s ease; }
  .ah-custom-row .input-ah-name { flex: 2; font-size: 13px; padding: 8px 12px; }
  .ah-custom-row .input-ah-key { width: 60px; text-align: center; font-family: var(--mono); font-weight: 700; font-size: 13px; padding: 8px; }
  .ah-custom-add { margin-top: 6px; padding: 6px 14px; background: transparent; border: 1px dashed var(--border-2); border-radius: 6px; color: var(--text-mute); cursor: pointer; font-size: 12px; font-weight: 600; width: 100%; font-family: inherit; transition: all 0.15s; }
  .ah-custom-add:hover { border-color: var(--text-mute); color: var(--text-dim); }

  /* ‚îÄ‚îÄ SCRIPT ‚îÄ‚îÄ */
  .script-box { background: var(--surface-3); border-radius: var(--radius-xl); padding: 20px; border: 1px solid var(--border); }
  .script-label { font-size: 13px; font-weight: 700; color: var(--red-3); margin-bottom: 12px; }
  .script-area { width: 100%; padding: 14px; background: #0e0e16; border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); font-family: var(--font); font-size: 14px; line-height: 1.8; min-height: 160px; outline: none; }
  .script-area:focus { border-color: var(--red); box-shadow: 0 0 0 3px rgba(238,0,0,0.1); }
  .script-stats { display: flex; gap: 12px; margin-top: 16px; padding: 14px; background: #0e0e16; border-radius: var(--radius); }
  .stat { flex: 1; text-align: center; }
  .stat-val { font-size: 22px; font-weight: 700; color: var(--red-3); font-family: var(--mono); }
  .stat-lbl { font-size: 12px; color: var(--text-dim); margin-top: 2px; }

  .config-box { background: var(--surface-3); border-radius: var(--radius-xl); padding: 20px; border: 1px solid var(--border); margin-top: 20px; }
  .config-label { font-size: 13px; font-weight: 700; color: var(--text-mid); margin-bottom: 12px; }
  .config-pre { font-family: var(--mono); font-size: 12px; color: var(--text-dim); line-height: 1.7; white-space: pre-wrap; margin: 0; }
  .final-pre { font-family: var(--font); font-size: 14px; color: #c8c8d8; line-height: 1.8; white-space: pre-wrap; margin: 0; }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn-primary { padding: 11px 22px; background: var(--red); color: #fff; border: none; border-radius: var(--radius); font-size: 14px; font-weight: 700; cursor: pointer; box-shadow: 0 2px 16px rgba(238,0,0,0.3); transition: all 0.2s; }
  .btn-primary:hover { filter: brightness(1.15); transform: translateY(-1px); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
  .btn-secondary { padding: 11px 22px; background: var(--surface-2); color: var(--text); border: 1px solid var(--border-2); border-radius: var(--radius); font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.15s; }
  .btn-secondary:hover { border-color: #3d3d5c; background: #222233; }

  /* ‚îÄ‚îÄ NAV / EXPORT ‚îÄ‚îÄ */
  .nav-row { display: flex; justify-content: space-between; margin-top: 20px; }
  .export-btns { display: flex; gap: 12px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
  .email-box { background: var(--surface-3); border-radius: var(--radius-xl); padding: 20px; border: 1px solid var(--border); margin-top: 24px; }
  .email-row { display: flex; gap: 10px; margin-top: 10px; }

  /* ‚îÄ‚îÄ PHASE 2 ‚îÄ‚îÄ */
  .phase2 { background: linear-gradient(135deg, rgba(238,0,0,0.04), rgba(238,0,0,0.01)); border: 2px dashed var(--red-border); border-radius: var(--radius-2xl); padding: 32px; text-align: center; margin-top: 28px; }
  .phase2 h3 { margin-bottom: 6px; color: var(--red-3); }
  .phase2 p { color: var(--text-dim); max-width: 480px; margin: 0 auto; font-size: 14px; line-height: 1.6; }
  .voice-grid { display: flex; gap: 12px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
  .voice-card { padding: 16px; background: var(--surface); border: 1px solid var(--border-2); border-radius: var(--radius-lg); width: 140px; text-align: center; font-size: 13px; }
  .cs-badge { display: inline-block; background: rgba(238,0,0,0.12); color: var(--red-2); padding: 3px 10px; border-radius: 12px; font-size: 10px; font-weight: 700; margin-top: 8px; }

  .footer { text-align: center; padding: 32px 0 8px; color: var(--text-mute); font-size: 13px; }
  .footer .red { color: var(--red-3); }

  .step-panel { display: none; }
  .step-panel.visible { display: block; animation: fadeIn 0.35s ease; }

  @media (max-width: 640px) {
    .header h1 { font-size: 22px; }
    .content { padding: 24px 18px; }
    .step-sub { display: none; }
    .progress-step { padding: 8px 10px; }
  }
</style>
</head>
<body>
<div class="app" id="app">

  <!-- HEADER -->
  <header class="header">
    <div class="header-top">
      <div class="logo-row">
        <div class="logo-mark">OT</div>
        <div><div class="logo-text">One Talk <span class="logo-sub">Auto Receptionist</span></div></div>
      </div>
      <div class="badge">PHASE 1 ‚Äî SCRIPT GENERATOR</div>
    </div>
    <h1>Automated Receptionist Generator</h1>
    <p>Build professional auto-attendant scripts for Verizon One Talk in minutes. Choose an industry template, customize departments, and generate a ready-to-use script.</p>
  </header>

  <div class="progress-bar" id="progressBar"></div>

  <div class="content">

    <!-- ‚ïê‚ïê‚ïê STEP 1 ‚ïê‚ïê‚ïê -->
    <div class="step-panel visible" id="step1">
      <div class="section-head">
        <h2>Business Information</h2>
        <p>Start with the basics ‚Äî we'll use this to build your custom script.</p>
      </div>
      <div class="field">
        <label class="field-label">Business Name <span class="req">*</span></label>
        <input type="text" class="input" id="businessName" placeholder="e.g. Acme Dental Group">
      </div>
      <div class="field">
        <label class="field-label">Industry Template</label>
        <p class="field-hint">Select your industry to customize your script.</p>
        <div class="industry-grid" id="industryGrid"></div>
      </div>
      <div class="field">
        <label class="field-label">Greeting Tone</label>
        <div class="tone-row" id="toneRow"></div>
      </div>
      <div class="field">
        <label class="field-label">Business Hours <span class="hint">(optional)</span></label>
        <input type="text" class="input" id="businessHours" placeholder="e.g. Monday ‚Äì Friday, 9:00 AM ‚Äì 5:00 PM" value="Monday ‚Äì Friday, 9:00 AM ‚Äì 5:00 PM">
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê STEP 2 ‚ïê‚ïê‚ïê -->
    <div class="step-panel" id="step2">
      <div class="section-head">
        <h2>Call Routing & Departments</h2>
        <p>Configure your phone menu. Each department maps to an extension key press in One Talk. Optionally add sub-menu options within each department.</p>
      </div>
      <div class="dept-header">
        <span class="col-name">Department</span>
        <span class="col-key">Key</span>
        <span class="col-del"></span>
      </div>
      <div id="deptList"></div>
      <button class="add-btn" onclick="addDepartment()">+ Add Department</button>

      <div class="sep"></div>
      <div class="opt-row">
        <label class="check-label" style="margin-bottom:0;">
          <input type="checkbox" id="enableOperator" checked onchange="toggleOperator()">
          Include Operator extension
        </label>
        <div class="field" id="operatorExtField" style="flex: 0 0 auto; margin-bottom: 0;">
          <label class="field-label">Operator Key</label>
          <input type="text" class="input" id="operatorExt" value="0" maxlength="2" style="width:70px; text-align:center; font-family:var(--mono); font-weight:700;" oninput="onOperatorChange()">
        </div>
        <label class="check-label" style="margin-bottom:0;">
          <input type="checkbox" id="includeSpanish">
          Include Spanish language option
        </label>
      </div>

      <div class="sep"></div>
      <div class="ah-box">
        <div class="ah-top">
          <div>
            <strong style="font-size:15px">After-Hours Greeting</strong>
            <p class="field-hint" style="margin-bottom:0">Plays outside of business hours. Callers will still need to select an option.</p>
          </div>
          <button class="toggle on" id="ahToggle" onclick="toggleAfterHours()">
            <div class="toggle-knob"></div>
          </button>
        </div>
        <div id="ahContent">
          <p class="field-hint">How should callers be routed after hours?</p>
          <div class="ah-mode-row">
            <button class="ah-mode-btn active" id="ahModeMirror" onclick="setAhMode('mirror')">
              <div class="mode-icon">üîÅ</div>
              <div class="mode-title">Mirror Main Menu</div>
              <div class="mode-desc">Same departments, "leave a message" language</div>
            </button>
            <button class="ah-mode-btn" id="ahModeCustom" onclick="setAhMode('custom')">
              <div class="mode-icon">‚úèÔ∏è</div>
              <div class="mode-title">Custom Menu</div>
              <div class="mode-desc">Different options for after hours</div>
            </button>
          </div>
          <div id="ahModeContent"></div>
        </div>
      </div>
      <div class="field">
        <label class="field-label">Special Instructions <span class="hint">(optional)</span></label>
        <textarea class="input" id="specialInstructions" rows="3" placeholder="e.g. If you know your party's extension, you may dial it at any time." style="min-height:80px;"></textarea>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê STEP 3 ‚ïê‚ïê‚ïê -->
    <div class="step-panel" id="step3">
      <div class="section-head">
        <h2>Review & Edit Script</h2>
        <p>Your generated script is below. Feel free to edit it directly ‚Äî changes are preserved.</p>
      </div>
      <div class="script-box">
        <div class="script-label">üìù Main Greeting</div>
        <textarea class="script-area" id="mainScript" rows="10"></textarea>
        <div class="script-stats" id="scriptStats"></div>
      </div>
      <div class="script-box" id="ahScriptBox" style="margin-top:20px; display:none;">
        <div class="script-label">üåô After-Hours Greeting</div>
        <textarea class="script-area" id="ahScript" rows="8"></textarea>
      </div>
      <div class="config-box">
        <div class="config-label">üìã One Talk Configuration Summary</div>
        <pre class="config-pre" id="configPreview3"></pre>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê STEP 4 ‚ïê‚ïê‚ïê -->
    <div class="step-panel" id="step4">
      <div style="text-align:center; padding:20px 0 10px;">
        <div style="font-size:56px; margin-bottom:12px;">üéâ</div>
        <h2 style="font-size:24px; font-weight:700; margin-bottom:6px;">Your Script is Ready!</h2>
        <p style="color:var(--text-dim); max-width:500px; margin:0 auto;">Copy the script, share it with your team, or send it via email to get started with One Talk.</p>
      </div>
      <div class="export-btns">
        <button class="btn-primary" onclick="copyFullScript()" id="copyBtn">üìã Copy Full Script</button>
        <button class="btn-secondary" onclick="copyConfig()">üìÑ Copy Config Summary</button>
      </div>
      <div class="script-box" style="margin-top:24px;">
        <div class="script-label">Main Greeting</div>
        <pre class="final-pre" id="finalMain"></pre>
      </div>
      <div class="script-box" id="finalAhBox" style="margin-top:16px; display:none;">
        <div class="script-label">After-Hours Greeting</div>
        <pre class="final-pre" id="finalAh"></pre>
      </div>
      <div class="config-box">
        <div class="config-label">One Talk Configuration Summary</div>
        <pre class="config-pre" id="configPreview4"></pre>
      </div>

      <!-- Email -->
      <div class="email-box">
        <strong>Send Script via Email</strong>
        <p class="field-hint">A copy will also be sent to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="523d3c3726333e39123d34343b3137313d3f3f273c3b3133263b3d3c217c3c3726">[email&#160;protected]</a></p>
        <div class="email-row">
          <input type="email" class="input" id="emailInput" placeholder="your@email.com" style="flex:1;">
          <button class="btn-primary" id="sendBtn" onclick="sendToWebhook()" style="min-width:100px;">Send</button>
        </div>
      </div>

      <!-- Phase 2 -->
      <div class="phase2">
        <div style="font-size:36px; margin-bottom:8px;">üîä</div>
        <h3>Coming Soon ‚Äî Phase 2: AI Voice Generation</h3>
        <p>Connect to ElevenLabs to generate professional audio files directly from your script. Choose from dozens of natural-sounding voices and download MP3/WAV files ready to upload to One Talk.</p>
        <div class="voice-grid">
          <div class="voice-card"><div style="font-size:28px; margin-bottom:4px;">üéôÔ∏è</div><strong>Rachel</strong><div style="font-size:12px; color:var(--text-dim);">Warm, professional female</div><div class="cs-badge">Coming Soon</div></div>
          <div class="voice-card"><div style="font-size:28px; margin-bottom:4px;">üéôÔ∏è</div><strong>Adam</strong><div style="font-size:12px; color:var(--text-dim);">Clear, authoritative male</div><div class="cs-badge">Coming Soon</div></div>
          <div class="voice-card"><div style="font-size:28px; margin-bottom:4px;">üéôÔ∏è</div><strong>Bella</strong><div style="font-size:12px; color:var(--text-dim);">Friendly, approachable female</div><div class="cs-badge">Coming Soon</div></div>
        </div>
      </div>
    </div>

  </div>

  <div class="nav-row" id="navRow"></div>
  <footer class="footer">Built for Verizon One Talk partners ¬∑ <span class="red">Office Communications</span></footer>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATA ‚Äî Industry Templates
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const templates = {
  general: {
    name: "General Business", icon: "üè¢",
    departments: [
      { name: "Sales", extension: "1", ring: "simultaneous", subs: [] },
      { name: "Support", extension: "2", ring: "simultaneous", subs: [] },
    ],
    afterHours: "Please leave a message and we will return your call during business hours.",
  },
  medical: {
    name: "Healthcare", icon: "üè•",
    departments: [
      { name: "Appointments", extension: "1", ring: "simultaneous", subs: [{ name: "New Patient", key: "1" }, { name: "Existing Patient", key: "2" }] },
      { name: "Billing", extension: "2", ring: "sequential", subs: [] },
      { name: "Pharmacy", extension: "3", ring: "sequential", subs: [] },
      { name: "Nurse Line", extension: "4", ring: "simultaneous", subs: [] },
    ],
    afterHours: "If this is a medical emergency, please hang up and dial 911. For urgent matters, press 9 to reach our on-call provider. Otherwise, please leave a detailed message.",
  },
  legal: {
    name: "Legal / Law Firm", icon: "‚öñÔ∏è",
    departments: [
      { name: "New Client Intake", extension: "1", ring: "simultaneous", subs: [] },
      { name: "Existing Cases", extension: "2", ring: "sequential", subs: [] },
      { name: "Billing", extension: "3", ring: "sequential", subs: [] },
    ],
    afterHours: "Our office is currently closed. Please leave a detailed message with your name and case number, and an attorney will return your call within one business day.",
  },
  retail: {
    name: "Retail", icon: "üõçÔ∏è",
    departments: [
      { name: "Sales", extension: "1", ring: "simultaneous", subs: [] },
      { name: "Customer Service", extension: "2", ring: "simultaneous", subs: [] },
      { name: "Returns", extension: "3", ring: "sequential", subs: [] },
    ],
    afterHours: "Please leave a message or visit our website for online orders.",
  },
  professional: {
    name: "Professional Services", icon: "üíº",
    departments: [
      { name: "Consulting", extension: "1", ring: "sequential", subs: [] },
      { name: "Support", extension: "2", ring: "simultaneous", subs: [] },
    ],
    afterHours: "Leave a message and we will get back to you during office hours.",
  },
  restaurant: {
    name: "Restaurant", icon: "üçΩÔ∏è",
    departments: [
      { name: "Reservations", extension: "1", ring: "simultaneous", subs: [] },
      { name: "Takeout / Delivery", extension: "2", ring: "simultaneous", subs: [] },
      { name: "Events & Catering", extension: "3", ring: "sequential", subs: [] },
    ],
    afterHours: "We are currently closed. Visit our website for reservations or online ordering.",
  },
  automotive: {
    name: "Automotive", icon: "üöó",
    departments: [
      { name: "Sales", extension: "1", ring: "simultaneous", subs: [{ name: "New Vehicles", key: "1" }, { name: "Pre-Owned", key: "2" }] },
      { name: "Service", extension: "2", ring: "sequential", subs: [] },
      { name: "Parts", extension: "3", ring: "sequential", subs: [] },
    ],
    afterHours: "To schedule service or inquire about vehicle availability, please leave a message.",
  },
  realestate: {
    name: "Real Estate", icon: "üè†",
    departments: [
      { name: "Sales / Listings", extension: "1", ring: "simultaneous", subs: [] },
      { name: "Property Mgmt", extension: "2", ring: "sequential", subs: [] },
      { name: "Leasing", extension: "3", ring: "simultaneous", subs: [] },
    ],
    afterHours: "Our office is currently closed. Leave a message with your name and the property you're inquiring about, and an agent will return your call.",
  },
  construction: {
    name: "Construction / Trades", icon: "üî®",
    departments: [
      { name: "New Projects / Estimates", extension: "1", ring: "simultaneous", subs: [] },
      { name: "Current Projects", extension: "2", ring: "sequential", subs: [] },
      { name: "Billing", extension: "3", ring: "sequential", subs: [] },
      { name: "Emergency Service", extension: "4", ring: "simultaneous", subs: [] },
    ],
    afterHours: "Our office is currently closed. For emergency service requests, press 9. Otherwise, please leave your name, number, and a description of your project, and we will return your call on the next business day.",
  },
  salon: {
    name: "Salon / Spa", icon: "üíá",
    departments: [
      { name: "Book Appointment", extension: "1", ring: "simultaneous", subs: [{ name: "Hair Services", key: "1" }, { name: "Spa & Skin", key: "2" }, { name: "Nails", key: "3" }] },
      { name: "Reschedule / Cancel", extension: "2", ring: "sequential", subs: [] },
      { name: "Products & Gift Cards", extension: "3", ring: "simultaneous", subs: [] },
    ],
    afterHours: "We are currently closed. You can book or manage appointments online at our website. Leave a message and we will get back to you when we reopen.",
  },
};

const tones = {
  professional: { name: "Professional", icon: "üëî", desc: "Formal & polished" },
  friendly: { name: "Friendly", icon: "üòä", desc: "Warm & welcoming" },
  efficient: { name: "Efficient", icon: "‚ö°", desc: "Brief & direct" },
};

const STEPS = [
  { num: 1, label: "Business Info", sub: "Name, industry & tone" },
  { num: 2, label: "Call Routing", sub: "Departments & hours" },
  { num: 3, label: "Review Script", sub: "Edit & customize" },
  { num: 4, label: "Export", sub: "Download & send" },
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let currentStep = 1;
let selectedIndustry = "general";
let selectedTone = "professional";
let departments = JSON.parse(JSON.stringify(templates.general.departments));
let afterHoursEnabled = true;
let ahMode = "mirror"; // "mirror" or "custom"
let ahCustomOptions = [
  { name: "Leave a General Message", key: "1" },
];
let generatedMain = "";
let generatedAH = "";

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function init() {
  renderProgress();
  renderIndustryGrid();
  renderToneRow();
  renderDepartments();
  renderAhContent();
  renderNav();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PROGRESS BAR
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderProgress() {
  const bar = document.getElementById("progressBar");
  bar.innerHTML = STEPS.map(s => {
    let cls = "progress-step";
    if (s.num === currentStep) cls += " active";
    else if (s.num < currentStep) cls += " done";
    const onclick = s.num <= currentStep ? `goToStep(${s.num})` : "";
    return `<button class="${cls}" ${onclick ? `onclick="${onclick}"` : ""}>
      <div class="step-circle">${s.num < currentStep ? "‚úì" : s.num}</div>
      <div><div class="step-label">${s.label}</div><div class="step-sub">${s.sub}</div></div>
    </button>`;
  }).join("");
}

function goToStep(n) {
  if (n === 3 && currentStep === 2) generateScript();
  if (n <= currentStep) { currentStep = n; showStep(); }
}

function showStep() {
  document.querySelectorAll(".step-panel").forEach((el, i) => {
    el.classList.toggle("visible", i + 1 === currentStep);
  });
  renderProgress();
  renderNav();
  window.scrollTo({ top: 0, behavior: "smooth" });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAVIGATION
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderNav() {
  const nav = document.getElementById("navRow");
  let html = "";
  if (currentStep > 1) html += `<button class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>`;
  else html += `<div></div>`;
  if (currentStep < 4) {
    const label = currentStep === 2 ? "Generate Script ‚Üí" : "Next ‚Üí";
    const disabled = currentStep === 1 && !document.getElementById("businessName")?.value.trim();
    html += `<button class="btn-primary" onclick="nextStep()" ${disabled ? "disabled" : ""}>${label}</button>`;
  }
  nav.innerHTML = html;
}

function nextStep() {
  if (currentStep === 1 && !document.getElementById("businessName").value.trim()) return;
  if (currentStep === 2) {
    if (!departments.some(d => d.name.trim())) return;
    generateScript();
  }
  currentStep = Math.min(currentStep + 1, 4);
  showStep();
  if (currentStep === 4) renderStep4();
}

function prevStep() { currentStep = Math.max(currentStep - 1, 1); showStep(); }

document.addEventListener("input", e => { if (e.target.id === "businessName") renderNav(); });

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INDUSTRY & TONE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderIndustryGrid() {
  const grid = document.getElementById("industryGrid");
  grid.innerHTML = Object.entries(templates).map(([key, t]) =>
    `<div class="industry-card ${selectedIndustry === key ? "active" : ""}" onclick="selectIndustry('${key}')">
      <span class="icon">${t.icon}</span><span>${t.name}</span>
    </div>`
  ).join("");
}

function selectIndustry(key) {
  selectedIndustry = key;
  departments = JSON.parse(JSON.stringify(templates[key].departments));
  renderIndustryGrid();
  renderDepartments();
}

function renderToneRow() {
  const row = document.getElementById("toneRow");
  row.innerHTML = Object.entries(tones).map(([key, t]) =>
    `<div class="tone-card ${selectedTone === key ? "active" : ""}" onclick="selectTone('${key}')">
      <span style="font-size:22px">${t.icon}</span><strong>${t.name}</strong><span class="desc">${t.desc}</span>
    </div>`
  ).join("");
}

function selectTone(key) { selectedTone = key; renderToneRow(); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DEPARTMENTS + SUBMENUS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderDepartments() {
  const list = document.getElementById("deptList");
  list.innerHTML = departments.map((d, i) => {
    const hasSubs = d.subs && d.subs.length > 0;
    let html = `<div class="dept-block">
      <div class="dept-main">
        <input class="input input-name" value="${escHtml(d.name)}" placeholder="Department name" oninput="deptChange(${i},'name',this.value)">
        <input class="input input-key" value="${escHtml(d.extension)}" maxlength="2" oninput="deptChange(${i},'extension',this.value)">
        <button class="remove-btn" onclick="removeDept(${i})" title="Remove">√ó</button>
      </div>`;

    // Submenu toggle button
    if (!hasSubs) {
      html += `<button class="submenu-toggle" onclick="enableSubs(${i})">+ Add Sub-Menu</button>`;
    }

    // Submenu area
    if (hasSubs) {
      html += `<div class="submenu-area">
        <div class="submenu-label">‚Ü≥ Sub-Menu Options</div>`;
      d.subs.forEach((s, si) => {
        html += `<div class="submenu-row">
          <input class="input input-sub-name" value="${escHtml(s.name)}" placeholder="Sub-option name" oninput="subChange(${i},${si},'name',this.value)">
          <input class="input input-sub-key" value="${escHtml(s.key)}" maxlength="1" oninput="subChange(${i},${si},'key',this.value)">
          <button class="sub-remove" onclick="removeSub(${i},${si})" title="Remove">√ó</button>
        </div>`;
      });
      html += `<button class="sub-add-btn" onclick="addSub(${i})">+ Add Sub-Option</button>
      </div>`;
    }

    html += `</div>`;
    return html;
  }).join("");
}

function deptChange(i, field, val) {
  departments[i][field] = val;
  if (ahMode === "mirror") renderAhContent();
}

function addDepartment() {
  const nextExt = String(Math.max(...departments.map(d => parseInt(d.extension) || 0), 0) + 1);
  departments.push({ name: "", extension: nextExt, ring: "simultaneous", subs: [] });
  renderDepartments();
  if (ahMode === "mirror") renderAhContent();
}

function removeDept(i) { departments.splice(i, 1); renderDepartments(); if (ahMode === "mirror") renderAhContent(); }

function enableSubs(i) {
  departments[i].subs = [{ name: "", key: "1" }];
  renderDepartments();
}

function addSub(i) {
  const nextKey = String(Math.max(...departments[i].subs.map(s => parseInt(s.key) || 0), 0) + 1);
  departments[i].subs.push({ name: "", key: nextKey });
  renderDepartments();
}

function removeSub(i, si) {
  departments[i].subs.splice(si, 1);
  renderDepartments();
}

function subChange(i, si, field, val) { departments[i].subs[si][field] = val; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   OPERATOR EXTENSION
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toggleOperator() {
  const enabled = document.getElementById("enableOperator").checked;
  document.getElementById("operatorExtField").style.display = enabled ? "block" : "none";
  if (ahMode === "mirror") renderAhContent();
}

function onOperatorChange() {
  if (ahMode === "mirror") renderAhContent();
}

function getOperatorExt() {
  const enabled = document.getElementById("enableOperator")?.checked;
  if (!enabled) return "";
  return document.getElementById("operatorExt")?.value.trim() || "";
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AFTER HOURS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toggleAfterHours() {
  afterHoursEnabled = !afterHoursEnabled;
  document.getElementById("ahToggle").className = afterHoursEnabled ? "toggle on" : "toggle off";
  document.getElementById("ahContent").style.display = afterHoursEnabled ? "block" : "none";
}

function setAhMode(mode) {
  ahMode = mode;
  document.getElementById("ahModeMirror").className = "ah-mode-btn" + (mode === "mirror" ? " active" : "");
  document.getElementById("ahModeCustom").className = "ah-mode-btn" + (mode === "custom" ? " active" : "");
  renderAhContent();
}

function renderAhContent() {
  const container = document.getElementById("ahModeContent");
  if (!container) return;

  if (ahMode === "mirror") {
    // Show a preview of what the mirrored menu will look like
    const activeDepts = departments.filter(d => d.name.trim());
    const opExt = getOperatorExt();
    let previewLines = "";
    if (activeDepts.length > 0) {
      activeDepts.forEach(d => {
        previewLines += `<div style="padding:2px 0;">Press <strong>${d.extension}</strong> ‚Üí Leave a message for <strong>${d.name}</strong></div>`;
      });
      if (opExt) {
        previewLines += `<div style="padding:2px 0;">Press <strong>${opExt}</strong> ‚Üí Leave a general message</div>`;
      }
    } else {
      previewLines = '<em>Add departments above to see the mirrored menu</em>';
    }
    container.innerHTML = `
      <div class="ah-preview">
        <div style="font-size:11px; font-weight:700; color:var(--text-mute); text-transform:uppercase; letter-spacing:0.06em; margin-bottom:8px;">After-Hours Menu Preview</div>
        ${previewLines}
      </div>`;
  } else {
    // Custom menu builder
    let html = `
      <div class="ah-custom-list">
        <div class="ah-custom-header">
          <span style="flex:2">Option</span>
          <span style="width:60px; text-align:center;">Key</span>
          <span style="width:28px"></span>
        </div>`;
    ahCustomOptions.forEach((opt, i) => {
      html += `<div class="ah-custom-row">
        <input class="input input-ah-name" value="${escHtml(opt.name)}" placeholder="e.g. Leave a message, Emergency line" oninput="ahCustomChange(${i},'name',this.value)">
        <input class="input input-ah-key" value="${escHtml(opt.key)}" maxlength="2" oninput="ahCustomChange(${i},'key',this.value)">
        <button class="sub-remove" onclick="removeAhCustom(${i})" title="Remove">√ó</button>
      </div>`;
    });
    html += `</div>
      <button class="ah-custom-add" onclick="addAhCustom()">+ Add Option</button>`;
    container.innerHTML = html;
  }
}

function ahCustomChange(i, field, val) { ahCustomOptions[i][field] = val; }

function addAhCustom() {
  const nextKey = String(Math.max(...ahCustomOptions.map(o => parseInt(o.key) || 0), 0) + 1);
  ahCustomOptions.push({ name: "", key: nextKey });
  renderAhContent();
}

function removeAhCustom(i) {
  ahCustomOptions.splice(i, 1);
  renderAhContent();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCRIPT GENERATION
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function generateScript() {
  const biz = document.getElementById("businessName").value.trim() || "[Business Name]";
  const hours = document.getElementById("businessHours").value.trim();
  const opExt = getOperatorExt();
  const spanish = document.getElementById("includeSpanish").checked;
  const special = document.getElementById("specialInstructions").value.trim();

  let greeting;
  if (selectedTone === "friendly") greeting = `Hello and thank you for calling ${biz}! We're glad you reached out.`;
  else if (selectedTone === "efficient") greeting = `Thank you for calling ${biz}.`;
  else greeting = `Thank you for calling ${biz}. Your call is important to us.`;

  const hoursLine = hours ? `\nOur office hours are ${hours}.` : "";
  const spanishLine = spanish ? `\nPara espa√±ol, oprima el ${departments.length + 1}.` : "";

  let menu = "\n\nPlease listen carefully, as our menu options may have changed.";
  departments.forEach(d => {
    if (d.name.trim()) {
      menu += `\nFor ${d.name}, press ${d.extension}.`;
    }
  });
  if (opExt) menu += `\nTo speak with an operator, press ${opExt}.`;
  menu += "\nTo repeat these options, press the pound key.";

  // Build submenu scripts for departments that have them
  let subScripts = "";
  departments.forEach(d => {
    if (d.name.trim() && d.subs && d.subs.length > 0 && d.subs.some(s => s.name.trim())) {
      subScripts += `\n\n--- ${d.name.toUpperCase()} SUB-MENU (Press ${d.extension}) ---\n`;
      subScripts += `You've reached ${d.name}. Please select from the following:`;
      d.subs.forEach(s => {
        if (s.name.trim()) subScripts += `\nFor ${s.name}, press ${s.key}.`;
      });
      subScripts += `\nTo return to the main menu, press the pound key.`;
    }
  });

  const specialLine = special ? `\n\n${special}` : "";
  generatedMain = `${greeting}${hoursLine}${spanishLine}${menu}${specialLine}${subScripts}`;

  // After-hours
  generatedAH = "";
  if (afterHoursEnabled) {
    generatedAH = `Thank you for calling ${biz}. You've reached us after hours.`;
    if (hours) generatedAH += ` Our regular business hours are ${hours}.`;

    generatedAH += `\n\n${templates[selectedIndustry].afterHours}`;

    if (ahMode === "mirror") {
      // Mirror main menu departments with "leave a message" language
      const activeDepts = departments.filter(d => d.name.trim());
      if (activeDepts.length > 0 || opExt) {
        generatedAH += "\n\nPlease select from the following options:";
        activeDepts.forEach(d => {
          generatedAH += `\nTo leave a message for ${d.name}, press ${d.extension}.`;
        });
        if (opExt) generatedAH += `\nTo leave a general message, press ${opExt}.`;
        generatedAH += "\nTo repeat these options, press the pound key.";
      }
    } else {
      // Custom after-hours options
      const activeOpts = ahCustomOptions.filter(o => o.name.trim());
      if (activeOpts.length > 0) {
        generatedAH += "\n\nPlease select from the following options:";
        activeOpts.forEach(o => {
          generatedAH += `\nFor ${o.name}, press ${o.key}.`;
        });
        generatedAH += "\nTo repeat these options, press the pound key.";
      }
    }
  }

  document.getElementById("mainScript").value = generatedMain;
  updateScriptStats();

  if (generatedAH) {
    document.getElementById("ahScriptBox").style.display = "block";
    document.getElementById("ahScript").value = generatedAH;
  } else {
    document.getElementById("ahScriptBox").style.display = "none";
  }
  document.getElementById("configPreview3").textContent = buildConfig();
}

function updateScriptStats() {
  const text = document.getElementById("mainScript").value;
  const words = text.split(/\s+/).filter(Boolean).length;
  const dur = Math.ceil(words / 2.5);
  const opts = departments.filter(d => d.name.trim()).length;
  document.getElementById("scriptStats").innerHTML = `
    <div class="stat"><div class="stat-val">${words}</div><div class="stat-lbl">Words</div></div>
    <div class="stat"><div class="stat-val">${dur}s</div><div class="stat-lbl">Est. Duration</div></div>
    <div class="stat"><div class="stat-val">${opts}</div><div class="stat-lbl">Menu Options</div></div>
  `;
}

document.addEventListener("input", e => { if (e.target.id === "mainScript") updateScriptStats(); });

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONFIG SUMMARY
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildConfig() {
  const biz = document.getElementById("businessName").value.trim() || "‚Äî";
  const hours = document.getElementById("businessHours").value.trim() || "Not specified";
  const opExt = getOperatorExt();
  const spanish = document.getElementById("includeSpanish").checked;

  const lines = [];
  lines.push(`BUSINESS: ${biz}`);
  lines.push(`INDUSTRY: ${templates[selectedIndustry].name}`);
  lines.push(`HOURS: ${hours}`);
  lines.push("");
  lines.push("MENU TREE:");
  departments.forEach(d => {
    if (d.name.trim()) {
      lines.push(`  Press ${d.extension} ‚Üí ${d.name}`);
      if (d.subs && d.subs.length > 0) {
        d.subs.forEach(s => {
          if (s.name.trim()) lines.push(`    Press ${s.key} ‚Üí ${s.name}`);
        });
      }
    }
  });
  if (opExt) lines.push(`  Press ${opExt} ‚Üí Operator`);
  if (spanish) lines.push(`  Press ${departments.length + 1} ‚Üí Spanish Menu`);
  lines.push("  Press # ‚Üí Repeat Menu");
  if (afterHoursEnabled) {
    lines.push("");
    lines.push("AFTER HOURS: Enabled");
    lines.push(`  Mode: ${ahMode === "mirror" ? "Mirror Main Menu" : "Custom Menu"}`);
    if (ahMode === "mirror") {
      departments.forEach(d => {
        if (d.name.trim()) lines.push(`  Press ${d.extension} ‚Üí Leave message for ${d.name}`);
      });
      if (opExt) lines.push(`  Press ${opExt} ‚Üí Leave a general message`);
    } else {
      ahCustomOptions.forEach(o => {
        if (o.name.trim()) lines.push(`  Press ${o.key} ‚Üí ${o.name}`);
      });
    }
    lines.push("  Press # ‚Üí Repeat Menu");
  }
  return lines.join("\n");
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STEP 4 RENDER
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderStep4() {
  generatedMain = document.getElementById("mainScript").value;
  generatedAH = document.getElementById("ahScript")?.value || "";

  document.getElementById("finalMain").textContent = generatedMain;
  if (generatedAH) {
    document.getElementById("finalAhBox").style.display = "block";
    document.getElementById("finalAh").textContent = generatedAH;
  } else {
    document.getElementById("finalAhBox").style.display = "none";
  }
  document.getElementById("configPreview4").textContent = buildConfig();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EXPORT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function copyFullScript() {
  const full = generatedMain + (generatedAH ? "\n\n‚îÅ‚îÅ‚îÅ AFTER HOURS GREETING ‚îÅ‚îÅ‚îÅ\n\n" + generatedAH : "");
  navigator.clipboard.writeText(full).then(() => {
    const btn = document.getElementById("copyBtn");
    btn.textContent = "‚úì Copied!";
    setTimeout(() => btn.textContent = "üìã Copy Full Script", 2000);
  });
}

function copyConfig() {
  navigator.clipboard.writeText(buildConfig());
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ZAPIER WEBHOOK
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function sendToWebhook() {
  const email = document.getElementById("emailInput").value.trim();
  const btn = document.getElementById("sendBtn");
  if (!email || btn.disabled) return;

  btn.disabled = true;
  btn.textContent = "Sending‚Ä¶";

  try {
    const full = generatedMain + (generatedAH ? "\n\n‚îÅ‚îÅ‚îÅ AFTER HOURS GREETING ‚îÅ‚îÅ‚îÅ\n\n" + generatedAH : "");
    await fetch("https://hooks.zapier.com/hooks/catch/2630762/uc1zyf1/", {
      method: "POST",
      body: JSON.stringify({
        email: email,
        cc: "onetalk@officecommunications.net",
        businessName: document.getElementById("businessName").value.trim(),
        industry: templates[selectedIndustry].name,
        tone: selectedTone,
        hours: document.getElementById("businessHours").value.trim(),
        departments: departments.filter(d => d.name.trim()).map(d => ({
          name: d.name,
          extension: d.extension,
          subMenu: (d.subs || []).filter(s => s.name.trim()).map(s => ({ name: s.name, key: s.key })),
        })),
        mainScript: generatedMain,
        afterHoursScript: generatedAH,
        afterHoursMode: ahMode,
        afterHoursCustomOptions: ahMode === "custom" ? ahCustomOptions.filter(o => o.name.trim()).map(o => ({ name: o.name, key: o.key })) : null,
        configSummary: buildConfig(),
        fullScript: full,
        includeSpanish: document.getElementById("includeSpanish").checked,
        operatorExtension: getOperatorExt(),
        timestamp: new Date().toISOString(),
      }),
    });
    btn.textContent = "‚úì Sent!";
    setTimeout(() => { btn.textContent = "Send"; btn.disabled = false; }, 4000);
  } catch (err) {
    console.error("Webhook error:", err);
    alert("Something went wrong sending the script. Please try again or copy the script manually.");
    btn.textContent = "Send";
    btn.disabled = false;
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UTIL
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function escHtml(str) {
  return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
}

init();
</script>
</body>
</html>
